# Garage filling | Mortgage
###### tags: `sinopac`
### 車庫問題
- 明明交易包含車位，`車位面積`或`車位總價`欄位卻未填寫（併入總價與建物面積），使得單價計算有誤
- `交易標的`、`交易筆棟數`、`車位類別`三個特徵都能表達車位的有無，但部份資料有表示不一致的情形
### 處理流程
Input $\Rightarrow$ 對齊車位資訊 $\Rightarrow$ 車位面積＆總價估計 $\Rightarrow$ 更新單價 $\Rightarrow$ 清理離群值$\Rightarrow$ Output
#### 對齊車位資訊
- 車位資訊欄位
    - `交易標的`＝`房地(土地+建物)+車位` $\leftarrow$ 代表有車位
    - `交易筆棟數`＝`土地x建物y車位z` $\leftarrow$ 代表有z個車位（存為變數`車位個數`）
    - `車位類別`$\ne$`null` $\leftarrow$ 代表有車位
- 刪除不合理的資料
    1. `車位面積` $\ne$ 0 且 `車位個數`＝0
    2. `車位總價`$\ne$ 0 且 `車位個數`＝0
    3. `交易標的`＝`房地(土地+建物)+車位` 且 `車位個數`＝0
    4. `車位類別`$\ne$`null` 且 `車位個數`＝0
    5. `車位個數`> 0 且 `交易標的`＝`房地(土地+建物)`
    6. `車位個數`> 0 且 `車位類別`＝`null` 
#### 車位面積＆總價估計
搜尋半徑50公尺以內的同類型車位，計算`車位面積`、`車位單價`的加權平均值，乘上`車位個數`當作估計值
- 車位單價
  `車位單價`＝`車位總價`/`車位個數`
- 半徑
  如果50公尺搜尋不到資料，將半徑改為50 * 2，依此類推
- 加權平均
  w＝0.9 ^ (`交易年`之差)
- 允許搜尋的時間
    - training set: 整個training set都可以是估計的來源
    - test set: 只能使用前一個月以前的所有資料當作估計來源
#### 更新單價
如果`車位個數`> 0
且 `總價`-`車位總價` > `車位總價`/`車位個數`
且 `面積`-`車位面積` > `車位面積`/`車位個數`，
則更新

$單價=\frac{總價-車位總價}{面積-車位面積}$

$面積=面積-車位面積$

#### 清理離群值(已棄用)
刪除單價落在+-5個標準差之外的資料
![](https://i.imgur.com/PsnZ5lP.png)

### 整體表現
##### weight_decay=0.9, radius_init=50

| 大樓 | 原單價 | 新單價 | 比較 || 華廈 | 原單價 | 新單價 | 比較 |
| ---- | ------ | ------ | ---- |-| ---- | ------ | ------ | ---- |
| 台北 | 71.1   | 77.9   | +6.8 || 台北 | 68.6   | 71.1   | +2.5 |
| 新北 | 81.7   | 86.0   | +4.3 || 新北 | 74.0   | 74.3   | +0.3 |
| 桃園 | 82.0   | 80.5   | -1.5 || 桃園 | 69.4   | 64.8   | -4.6 |
| 台中 | 80.0   | 79.4   | -0.6 || 台中 | 63.2   | 61.5   | -1.7 |
| 台南 | 72.8   | 71.4   | -1.4 || 台南 | 62.8   | 60.0   | -2.8 |
| 高雄 | 79.0   | 75.3   | -3.7 || 高雄 | 57.3   | 53.1   | -4.2 |
| 竹市 | 84.3   | 82.8   | -1.5 || 竹市 | 69.2   | 62.9   | -6.3 |
| 竹縣 | 82.3   | 83.8   | +1.5 || 竹縣 | 71.2   | 67.0   | -4.2 |


### 討論
#### 1. 為什麼雙北補車位表現變好，其他縣市卻變差?
[車位估價模型分析](https://docs.google.com/presentation/d/1KCcSrC9usk83i8bzcRTUbL7IHoYxVApUiznhM_Pz4qY/edit?usp=sharing)
#### 2. 有車位總價亂填
![](https://i.imgur.com/VNQOmZ0.png)
懷疑是輸入錯誤或單位誤認

